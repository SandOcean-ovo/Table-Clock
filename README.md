# 墨滴时钟 (Ink-Drop Clock) - 一款基于STM32与U8g2的精致桌面时钟

![墨滴时钟主界面](https://pic1.imgdb.cn/item/68cac34fc5157e1a8812e0b8.gif) *<p align="center">一个展示主时钟界面和流畅动画的GIF动图</p>*
## ✨ 项目简介 (Introduction)

**墨滴时钟 (Ink-Drop Clock)** 是一款基于STM32和U8g2图形库打造的高性能、高颜值桌面时钟。它不仅仅是一个时间显示器，更是一个追求极致用户体验的嵌入式GUI项目。项目最大的特色在于其**流畅、细腻的动画效果**，例如“老虎机”式的日期时间选择器和带有惯性回弹的滚动列表，旨在为用户带来“墨滴入水”般顺滑自然的操作感受。

本项目从零开始，完整实现了包括**页面管理、动画引擎、输入处理、数据持久化**在内的全套应用框架。

---

## 🚀 主要特性 

*   **精致的主时钟界面**: 实时显示时间、日期、星期和温湿度信息。
*   **流畅的动画系统**:
    *   所有页面切换均采用平滑过渡动画。
    *   “**老虎机**”式日期/时间选择器，带有动态放大聚焦效果。
    *   支持**循环滚动**的菜单列表，带有智能“可视区域”管理和边界动画。
*   **完善的设置菜单**:
    *   **时间/日期设置**: 独立的时间和日期设置界面，交互友好。
    *   **自动熄屏**: 支持多种超时选项（30s, 1min, 5min, 10min, 从不），节能环保。
    *   **夏令时 : 支持手动开启/关闭夏令时，自动调整时间显示。
    *   **语言选择**: 预留多语言支持框架。
*   **精准可靠的时间系统**:
    *   采用 **DS3231** 高精度实时时钟模块，带温度补偿，走时精准。
*   **断电记忆**:
    *   所有用户设置（如自动熄屏时间、夏令时开关）均通过 **AT24C32 EEPROM** 进行持久化存储，断电不丢失。
*   **物理交互**:
    *   使用**旋转编码器**进行导航和数值调整，操作精准高效。

---

## 硬件清单 (Hardware Requirements)

| 组件       | 型号/规格                 | 备注               |
| :------- | :-------------------- | :--------------- |
| **微控制器** | STM32F103C8T6 (核心板)   | 或其他兼容的STM32型号    |
| **显示屏**  | 0.96英寸 OLED (SSD1306) | I2C接口, 128x64分辨率 |
| **时钟模块** | DS3231 高精度RTC模块       | 板载AT24C32 EEPROM |
| **输入设备** | EC11 旋转编码器            | 带按键功能            |
| **传感器**  | AHT20 温湿度传感器          | I2C接口            |

---

## 🛠️ 软件与库 (Software & Libraries)

*   **开发环境**: STM32CubeIDE / Keil MDK / VSCode + PlatformIO
*   **核心库**:
    *   **STM32 HAL Lib**: 官方底层硬件抽象库。
    *   **U8g2 Lib**: 功能强大的单色屏图形库，用于UI绘制。
*   **项目结构**:
    *   **应用层 (App)**: 包含页面管理、UI逻辑、输入处理等。
    *   **驱动层 (Driver)**: 封装了DS3231、AT24C32等硬件模块的底层驱动。
    *   **核心 (Core)**: STM32CubeMX生成的项目核心代码。

---

## 📸 功能演示 (Screenshots & GIFs)

*在这里放入更多展示你酷炫功能的图片或GIF！*

**1. "老虎机"式时间设置**
![老虎机](https://pic1.imgdb.cn/item/68cac34ec5157e1a8812e0b4.gif)
*<p align="center">从并列视图放大到聚焦视图，并进行滚动选择的完整动画</p>*

**2. 智能滚动列表**
![滚动](https://pic1.imgdb.cn/item/68cac352c5157e1a8812e0c0.gif)
*<p align="center">演示了列表在可视区内外的平滑滚动和边界环绕动画</p>*

**3. 保存设置提示**
![保存提示](https://pic1.imgdb.cn/item/68cac34dc5157e1a8812e0b2.gif)
*<p align="center">操作完成后给予清晰的视觉反馈</p>*

---

## 💡 核心设计与实现亮点

1.  **分层状态机与动画引擎**:
    *   每个复杂页面（如时间设置）都由一个精密的**分层状态机**驱动，管理着“进入”、“放大”、“聚焦”、“缩小”、“切换”等多种状态。
    *   动画循环独立于主逻辑，通过线性插值  和**缓动函数** 计算UI元素的实时位置、大小和透明度，实现了丝滑的过渡效果。

2.  **健壮的数据持久化**:
    *   `app_settings.c` 模块实现了对设置数据的**校验和** 验证机制。
    *   每次加载设置时，都会检查魔法数和校验和，确保数据的完整性。若验证失败，则自动恢复为出厂默认设置，避免了因EEPROM数据损坏导致的程序崩溃。

3.  **事件驱动的通用页面管理器**
    *   为了实现复杂的UI逻辑和流畅的多级菜单导航，我并未使用简单的 `if-else` 或 `switch-case` 结构，而是设计并实现了一个**通用的、可扩展的页面管理框架** (`app_display.c`)。
    *   这个框架将UI的各个部分抽象为独立的“**页面**”对象，极大地降低了代码的耦合度，使得添加、删除或修改页面变得异常简单。

    **a. 设计理念与核心组件:**
    *   **面向对象思想**: 每个UI界面都被抽象成一个 `Page_Base` 结构体，它封装了该页面的**所有行为**（`enter`, `exit`, `loop`, `draw`, `action`）和**属性**（`page_name`, `refresh_rate_ms`）。这种设计使得每个页面都是一个高内聚、低耦合的独立模块。
    *   **页面历史堆栈**: 管理器内部维护一个页面历史堆栈，实现了健壮的、支持多级嵌套的“**返回上一页**” (`Go_Back_Page()`) 功能，这对于构建复杂菜单至关重要。
    *   **事件驱动**: 页面管理器通过 `input` 模块获取用户输入事件，并将其**分发**给当前活动页面的 `action` 处理函数。页面本身不关心输入的硬件细节，只处理抽象的事件，实现了UI逻辑与底层驱动的解耦。

    **b. 动画与工作流程:**

    *   **统一的切换动画**: 所有页面间的切换 (`Switch_Page` 和 `Go_Back_Page`) 都由管理器统一处理，自动应用平滑的**左右推拉式过渡动画**。动画期间，管理器会同时绘制来源页面和目标页面，并通过插值计算它们的实时位移，保证了视觉效果的一致性和流畅性。
    *   **双状态刷新机制**: 管理器拥有 `IDLE` 和 `ANIMATING` 两种状态。在 `ANIMATING` 状态下，它会以最高帧率进行刷新以保证动画顺滑；在 `IDLE` 状态下，则会根据每个页面自己定义的 `refresh_rate_ms` 按需刷新，有效降低了MCU的负载。

    这个框架的设计不仅支撑了本项目所有复杂的UI功能，而且具有很强的**可移植性和可复用性**，可以轻松地被应用到其他嵌入式GUI项目中。

---

## 🚀 如何开始 (Getting Started)

1.  **克隆仓库**:
    ```bash
    git clone https://github.com/SandOcean-ovo/Table-Clock.git
    ```
2.  **硬件连接**:
    *   请参照 `docs/hardware_connections.png` 的原理图进行硬件连接。
3.  **编译与烧录**:
    *   使用 Keil 打开`MDK-ARM/Table Clock.uvprojx`。
    *   点击 `Build` 进行编译。
    *   通过 ST-Link 连接核心板并点击 `Run` 进行烧录。

---

## 展望 (Future Work)

*   [ ] **完善中文支持**: 探索使用压缩字库或外部Flash芯片的方案，实现美观且高效的中文显示。
*   [ ] **增加物理反馈**: 集成微型震动马达或蜂鸣器，为用户操作提供触觉或听觉反馈。
*   [ ] **网络功能 (V2.0)**: 升级至ESP32，实现NTP网络校时和天气预报功能。

---

## 致谢 (Acknowledgements)

*   感谢 [olikraus](https://github.com/olikraus) 创造了伟大的 U8g2 图形库。
*   感谢 江协科技的[STM32入门教程](https://www.bilibili.com/video/BV1th411z7sn/)，梦开始的地方。
*   感谢 嘉立创 免费帮我打板子。
